var events = require('events');
var util = require('util');

// Our type
function SideBar(jquery_element) {
	events.EventEmitter.call(this);
	this.element = jquery_element;
	this.favorites = $(jquery_element).children('#favorites');
    //this.side_bar = sidebar;
	var self = this;
	/*
	// Click on blank
	this.element.parent().on('click', function() {
		self.element.children('.focus').removeClass('focus');
	});
	// Click on file
	this.element.delegate('.file', 'click', function(e) {
		self.element.children('.focus').removeClass('focus');
		$(this).addClass('focus');
		e.stopPropagation();
	});
	// Double click on file
	this.element.delegate('.file', 'dblclick', function() {
	    var file_json = self.find_json_by_path($(this).attr('data-path'));
	    var file_path = file_json.path;
	    //console.log('file_json:', file_json);
	    if(file_json){
            var children = self.side_bar.children('li');
            for(var i=0; i<children.length; i++){
                child = $(children[i]);
                //console.log('child length',child.attr('data-path'), file_path);            
                if(child.attr('data-path') == file_path){
                    //console.log("match match");
                    self.side_bar.children('.active').removeClass('active');
                    self.side_bar.find('.icon-white').removeClass('icon-white');
                    child.addClass('active');
                    child.children('a').children('i').addClass('icon-white ');
                    break;
                }
            }
		    self.emit('navigate', file_json);//mime.stat(file_path, file_type)
		}
	});
	*/
}

util.inherits(SideBar, events.EventEmitter);

SideBar.prototype.set_favorites = function(favorites_json){
    var self = this;
    var result = [];
    result.push('<li class="nav-header">Favorites</li>');
	result.push('<li data-path="root" class="active"><a href="#"><i class="icon-white icon-home"></i> Root</a></li>');
    for(var i=0; i< favorites_json.length; i++){
        var str='<li data-path="'+favorites_json[i].path+'"><a href="#"><i class="';
        switch(favorites_json[i].name)
        {
            case 'Contacts':
                str+='icon-user';
                break;
            case 'Pictures':
                str+='icon-picture';
                break;
            case 'Videos':
                str+='icon-film';
                break;
            case 'Documents':
                str+='icon-book';
                break;
            case 'Musics':
                str+='icon-music';
                break;
        }
        str+='"></i> '+favorites_json[i].name+'</a></li>';
	    result.push(str);
	}
	result.push('<li class="divider"></li>');
	//result.push('<li data-path="about"><a href="#"><i class="icon-flag"></i> About</a></li>');
    self.favorites.html(result.join('\n'));
	self.favorites.delegate('a', 'click', function() {
		self.favorites.children('.active').removeClass('active');
		self.favorites.find('.icon-white').removeClass('icon-white');
		$(this).parent().addClass('active');
		$(this).children('i').addClass('icon-white ');
		var file_path = $(this).parent().attr('data-path');		
	    //var file_json = global_self.find_json_by_path(file_path);
	    //console.log('click on side_bar', file_json);
	    //if(file_json){
		    //global_self.emit('navigate', file_json);
		//}
		if('about' == file_path){
		    window.alert('in developing...^_^');
		}else{
            //self.open(file_path);
            self.emit('open_favorite', file_path);
        }
	});
}
SideBar.prototype.set_favorites_focus = function(mime){
    self = this;
    var file_path = mime.path;
    var children = self.favorites.children('li');
    for(var i=0; i<children.length; i++){
        child = $(children[i]);
        //console.log('child length',child.attr('data-path'), file_path);    
        if(child.attr('data-path') == file_path){
            //console.log("match match");
            self.favorites.children('.active').removeClass('active');
            self.favorites.find('.icon-white').removeClass('icon-white');
            child.addClass('active');
            child.children('a').children('i').addClass('icon-white ');
            break;
        }
    }
}
SideBar.prototype.find_json_by_path = function(filepath){
    var all = file_arch_json[global_dir];
    //console.log('global_dir', global_dir);
    //console.log('filepath', filepath);
    //console.log('file_arch_json[global_dir]', file_arch_json[global_dir]);
    var file = false;
    for(var i=0; i<all.length; i++){
        if(all[i].path == filepath){
            file = all[i];
            break;
        }
    }
    return file;
}

exports.SideBar = SideBar;
