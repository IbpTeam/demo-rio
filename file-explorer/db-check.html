<html>
<head>
<title>db-check</title>
<script type="text/javascript" src="js/jquery-1.7.2.js"></script>
<script type="text/javascript" src="../backend/api.js"></script>
<script type="text/javascript" src="../backend/apiHttpHandle.js"></script>
</head>
<meta charset="UTF-8">

<body>

<script>
function loadResourcesCb(result){
    $("body").css("cursor", "default");
    console.log('end of load resource callback.');
  document.write(result);
}
//API loadResources:读取某个资源文件夹到数据库
//返回字符串：
//成功返回success;
//失败返回失败原因
function loadResources(loadResourcesCb,path) {
    if(!path){
        path = $('div#db_add #dir_path').text();
    }
    $("body").css("cursor", "wait");
  console.log("Request handler 'loadResources' was called.");
  //调用函数，返回一个数组,r[0]是浏览器名称，r[1]是版本号
  var r=browser();
  console.log('You are using ' + r[0]);  
  if(r[0]=="Fuck")  {
    var apiLocalHandle = require("./backend/apiLocalHandle");
    apiLocalHandle.loadResourcesFromLocal(loadResourcesCb,path);
  }else{
    loadResourcesFromHttp(loadResourcesCb,path);
  }
}
//loadResources(loadResourcesCb,'/home/v1/resources');
 function chooseFile(name) {
    var chooser = document.querySelector(name);
    chooser.addEventListener("change", function(evt) {
      //console.log(this.value);
      var dir = this.value;
      if(dir){
        //document.getElementById('dir_path')
        $('div#db_add #dir_path').text(dir);
        $('div#db_add #btn_insert').css({"display":"inline"});
        $('div#db_add #btn_choose').val("重新选择路径");
      }
    }, false);
    chooser.click();  
  }
</script>
<div id="db_add">
    <input id="fileDialog" style="display:none;" type="file" nwdirectory/><br>
    <input id="btn_choose" type="button" onclick="chooseFile('#fileDialog')" value="选择文件路径"></input>
    <label id="dir_path"></label><br>
    <input id="btn_insert" style="display:none;" type="button" onclick="loadResources(loadResourcesCb)" value="扫描路径下的文件，并加入数据库"></input>
</div>
<hr>
<!--
<input id="dir_path" type="text"></input><br>
-->

</body>
</html>
